'use strict';(function(k){"function"===typeof define&&define.amd?define(["jquery"],k):"object"===typeof exports?k(require("jquery")):k(jQuery)})(function(k){function p(a){return"number"===typeof a&&!isNaN(a)}function B(a){return"undefined"===typeof a}function D(a,c){var b=[];p(c)&&b.push(c);return b.slice.apply(a,b)}function E(a,c){var b=D(arguments,2);return function(){return a.apply(c,b.concat(D(arguments)))}}function I(a){return(a=a.match(/^(https?:)\/\/([^\:\/\?#]+):?(\d*)/i))&&(a[1]!==F.protocol||a[2]!==F.hostname||a[3]!==F.port)}function J(a){var c="timestamp\x3d"+(new Date).getTime();return a+(-1===a.indexOf("?")?"?":"\x26")+c}function K(a){return a?' crossOrigin\x3d"'+a+'"':""}function W(a,c){var b;if(a.naturalWidth&&!L)return c(a.naturalWidth,a.naturalHeight);b=document.createElement("img");b.onload=function(){c(this.width,this.height)};b.src=a.src}function G(a){var c=[],b=a.rotate,d=a.scaleX;a=a.scaleY;p(b)&&0!==b&&c.push("rotate("+b+"deg)");p(d)&&1!==d&&c.push("scaleX("+d+")");p(a)&&1!==a&&c.push("scaleY("+a+")");return c.length?c.join(" "):"none"}function C(a,c){var b=z(a.degree)%180,d=(90<b?180-b:b)*Math.PI/180,b=X(d),d=Y(d),f=a.width,g=a.height;a=a.aspectRatio;c?(c=f/(d+b/a),b=c/a):(c=f*d+g*b,b=f*b+g*d);return{width:c,height:b}}function M(a,c){var b=k("\x3ccanvas\x3e")[0],d=b.getContext("2d"),f=0,g=0,e=c.naturalWidth,n=c.naturalHeight,h=c.rotate,m=c.scaleX;c=c.scaleY;var H=p(m)&&p(c)&&(1!==m||1!==c),t=p(h)&&0!==h,r=t||H,y=e*z(m||1),u=n*z(c||1),l,q;H&&(l=y/2,q=u/2);t&&(l=C({width:y,height:u,degree:h}),y=l.width,u=l.height,l=y/2,q=u/2);b.width=y;b.height=u;r&&(f=-e/2,g=-n/2,d.save(),d.translate(l,q));t&&d.rotate(h*Math.PI/180);H&&d.scale(m,c);d.drawImage(a,v(f),v(g),v(e),v(n));r&&d.restore();return b}function Z(a){var c=a.length,b=0,d=0;c&&(k.each(a,function(a,c){b+=c.pageX;d+=c.pageY}),b/=c,d/=c);return{pageX:b,pageY:d}}function aa(a){a=a.replace(ba,"");a=atob(a);var c=a.length,b=new N(c),d=new O(b),f;for(f=0;f<c;f++)d[f]=a.charCodeAt(f);return b}function x(a,c){this.$element=k(a);this.options=k.extend({},x.DEFAULTS,k.isPlainObject(c)&&c);this.isImg=this.wheeling=this.isLimited=this.isReplaced=this.isDisabled=this.isCropped=this.isRotated=this.isCompleted=this.isBuilt=this.isLoaded=!1;this.originalUrl="";this.cropBox=this.canvas=null;this.init()}var P=k(window),Q=k(document),F=window.location,R=window.navigator,N=window.ArrayBuffer,O=window.Uint8Array,ca=window.DataView,da=window.btoa,ea=/^(e|w|s|n|se|sw|ne|nw|all|crop|move|zoom)$/,fa=/^data:/,ba=/^data:([^;]+);base64,/,ga=/^data:image\/jpeg.*;base64,/,S=k.isFunction(k("\x3ccanvas\x3e")[0].getContext),L=R&&/(Macintosh|iPhone|iPod|iPad).*AppleWebKit/i.test(R.userAgent),q=Number,r=Math.min,l=Math.max,z=Math.abs,X=Math.sin,Y=Math.cos,T=Math.sqrt,U=Math.round,v=Math.floor,V=String.fromCharCode;x.prototype={constructor:x,init:function(){var a=this.$element,c;if(a.is("img")){this.isImg=!0;this.originalUrl=c=a.attr("src");if(!c)return;c=a.prop("src")}else a.is("canvas")&&S&&(c=a[0].toDataURL());this.load(c)},trigger:function(a,c){a=k.Event(a,c);this.$element.trigger(a);return a},load:function(a){var c=this.options,b=this.$element,d,f;if(a&&(b.one("build.cropper",c.build),!this.trigger("build.cropper").isDefaultPrevented())){this.url=a;this.image={};if(!c.checkOrientation||!N)return this.clone();d=k.proxy(this.read,this);if(fa.test(a))return ga.test(a)?d(aa(a)):this.clone();f=new XMLHttpRequest;f.onerror=f.onabort=k.proxy(function(){this.clone()},this);f.onload=function(){d(this.response)};c.checkCrossOrigin&&I(a)&&b.prop("crossOrigin")&&(a=J(a));f.open("get",a);f.responseType="arraybuffer";f.send()}},read:function(a){var c=this.options,b;b=new ca(a);var d=b.byteLength,f,g,e,n,h;if(255===b.getUint8(0)&&216===b.getUint8(1))for(h=2;h<d;){if(255===b.getUint8(h)&&225===b.getUint8(h+1)){g=h;break}h++}if(g){var d=g+10,m=g+4;g="";h=m;for(m=4+m;h<m;h++)g+=V(b.getUint8(h));"Exif"===g&&(g=b.getUint16(d),!(e=18761===g)&&19789!==g||42!==b.getUint16(d+2,e)||(g=b.getUint32(d+4,e),8<=g&&(n=d+g)))}if(n)for(d=b.getUint16(n,e),g=0;g<d;g++)if(h=n+12*g+2,274===b.getUint16(h,e)){h+=8;f=b.getUint16(h,e);L&&b.setUint16(h,1,e);break}b=f;f=this.image;e=0;d=n=1;if(1<b){a=new O(a);g=a.length;h="";for(m=0;m<g;m++)h+=V(a[m]);this.url="data:image/jpeg;base64,"+da(h);switch(b){case 2:n=-1;break;case 3:e=-180;break;case 4:d=-1;break;case 5:e=90;d=-1;break;case 6:e=90;break;case 7:e=90;n=-1;break;case 8:e=-90}}c.rotatable&&(f.rotate=e);c.scalable&&(f.scaleX=n,f.scaleY=d);this.clone()},clone:function(){var a=this.$element,c=this.url,b="",d;this.options.checkCrossOrigin&&I(c)&&((b=a.prop("crossOrigin"))?d=c:(b="anonymous",d=J(c)));this.crossOrigin=b;this.crossOriginUrl=d;this.$clone=c=k("\x3cimg"+K(b)+' src\x3d"'+(d||c)+'"\x3e');if(this.isImg)if(a[0].complete)this.start();else a.one("load.cropper",k.proxy(this.start,this));else c.one("load.cropper",k.proxy(this.start,this)).one("error.cropper",k.proxy(this.stop,this)).addClass("cropper-hide").insertAfter(a)},start:function(){var a=this.$element,c=this.$clone;this.isImg||(c.off("error.cropper",this.stop),a=c);W(a[0],k.proxy(function(a,c){k.extend(this.image,{naturalWidth:a,naturalHeight:c,aspectRatio:a/c});this.isLoaded=!0;this.build()},this))},stop:function(){this.$clone.remove();this.$clone=null},build:function(){var a=this.options,c=this.$element,b=this.$clone,d,f,g;this.isLoaded&&(this.isBuilt&&this.unbuild(),this.$container=c.parent(),this.$cropper=d=k(x.TEMPLATE),this.$canvas=d.find(".cropper-canvas").append(b),this.$dragBox=d.find(".cropper-drag-box"),this.$cropBox=f=d.find(".cropper-crop-box"),this.$viewBox=d.find(".cropper-view-box"),this.$face=g=f.find(".cropper-face"),c.addClass("cropper-hidden").after(d),this.isImg||b.removeClass("cropper-hide"),this.initPreview(),this.bind(),a.aspectRatio=l(0,a.aspectRatio)||NaN,a.viewMode=l(0,r(3,U(a.viewMode)))||0,a.autoCrop?(this.isCropped=!0,a.modal&&this.$dragBox.addClass("cropper-modal")):f.addClass("cropper-hidden"),a.guides||f.find(".cropper-dashed").addClass("cropper-hidden"),a.center||f.find(".cropper-center").addClass("cropper-hidden"),a.cropBoxMovable&&g.addClass("cropper-move").data("action","all"),a.highlight||g.addClass("cropper-invisible"),a.background&&d.addClass("cropper-bg"),a.cropBoxResizable||f.find(".cropper-line, .cropper-point").addClass("cropper-hidden"),this.setDragMode(a.dragMode),this.render(),this.isBuilt=!0,this.setData(a.data),c.one("built.cropper",a.built),this.completing=setTimeout(k.proxy(function(){this.trigger("built.cropper");this.trigger("crop.cropper",this.getData());this.isCompleted=!0},this),0))},unbuild:function(){this.isBuilt&&(this.isCompleted||clearTimeout(this.completing),this.isCompleted=this.isBuilt=!1,this.cropBox=this.canvas=this.container=this.initialCropBox=this.initialCanvas=this.initialImage=null,this.unbind(),this.resetPreview(),this.$container=this.$canvas=this.$dragBox=this.$cropBox=this.$viewBox=this.$preview=null,this.$cropper.remove(),this.$cropper=null)},render:function(){this.initContainer();this.initCanvas();this.initCropBox();this.renderCanvas();this.isCropped&&this.renderCropBox()},initContainer:function(){var a=this.options,c=this.$element,b=this.$container,d=this.$cropper;d.addClass("cropper-hidden");c.removeClass("cropper-hidden");d.css(this.container={width:l(b.width(),q(a.minContainerWidth)||200),height:l(b.height(),q(a.minContainerHeight)||100)});c.addClass("cropper-hidden");d.removeClass("cropper-hidden")},initCanvas:function(){var a=this.options.viewMode,c=this.container,b=c.width,c=c.height,d=this.image,f=d.naturalWidth,g=d.naturalHeight,e=90===z(d.rotate),n=e?g:f,e=e?f:g,h=n/e,f=b,g=c;c*h>b?3===a?f=c*h:g=b/h:3===a?g=b/h:f=c*h;n={naturalWidth:n,naturalHeight:e,aspectRatio:h,width:f,height:g};n.oldLeft=n.left=(b-f)/2;n.oldTop=n.top=(c-g)/2;this.canvas=n;this.isLimited=1===a||2===a;this.limitCanvas(!0,!0);this.initialImage=k.extend({},d);this.initialCanvas=k.extend({},n)},limitCanvas:function(a,c){var b=this.options,d=b.viewMode,f=this.container,g=f.width,f=f.height,e=this.canvas,n=e.aspectRatio,h=this.cropBox,m=this.isCropped&&h;a&&(a=q(b.minCanvasWidth)||0,b=q(b.minCanvasHeight)||0,d&&(1<d?(a=l(a,g),b=l(b,f),3===d&&(b*n>a?a=b*n:b=a/n)):a?a=l(a,m?h.width:0):b?b=l(b,m?h.height:0):m&&(a=h.width,b=h.height,b*n>a?a=b*n:b=a/n)),a&&b?b*n>a?b=a/n:a=b*n:a?b=a/n:b&&(a=b*n),e.minWidth=a,e.minHeight=b,e.maxWidth=Infinity,e.maxHeight=Infinity);c&&(d?(c=g-e.width,b=f-e.height,e.minLeft=r(0,c),e.minTop=r(0,b),e.maxLeft=l(0,c),e.maxTop=l(0,b),m&&this.isLimited&&(e.minLeft=r(h.left,h.left+h.width-e.width),e.minTop=r(h.top,h.top+h.height-e.height),e.maxLeft=h.left,e.maxTop=h.top,2===d&&(e.width>=g&&(e.minLeft=r(0,c),e.maxLeft=l(0,c)),e.height>=f&&(e.minTop=r(0,b),e.maxTop=l(0,b))))):(e.minLeft=-e.width,e.minTop=-e.height,e.maxLeft=g,e.maxTop=f))},renderCanvas:function(a){var c=this.canvas,b=this.image,d=b.rotate,f=b.naturalWidth,g=b.naturalHeight,e;this.isRotated&&(this.isRotated=!1,e=C({width:b.width,height:b.height,degree:d}),b=e.width/e.height,b!==c.aspectRatio&&(c.left-=(e.width-c.width)/2,c.top-=(e.height-c.height)/2,c.width=e.width,c.height=e.height,c.aspectRatio=b,c.naturalWidth=f,c.naturalHeight=g,d%180&&(e=C({width:f,height:g,degree:d}),c.naturalWidth=e.width,c.naturalHeight=e.height),this.limitCanvas(!0,!1)));if(c.width>c.maxWidth||c.width<c.minWidth)c.left=c.oldLeft;if(c.height>c.maxHeight||c.height<c.minHeight)c.top=c.oldTop;c.width=r(l(c.width,c.minWidth),c.maxWidth);c.height=r(l(c.height,c.minHeight),c.maxHeight);this.limitCanvas(!1,!0);c.oldLeft=c.left=r(l(c.left,c.minLeft),c.maxLeft);c.oldTop=c.top=r(l(c.top,c.minTop),c.maxTop);this.$canvas.css({width:c.width,height:c.height,left:c.left,top:c.top});this.renderImage();this.isCropped&&this.isLimited&&this.limitCropBox(!0,!0);a&&this.output()},renderImage:function(a){var c=this.canvas,b=this.image,d;b.rotate&&(d=C({width:c.width,height:c.height,degree:b.rotate,aspectRatio:b.aspectRatio},!0));k.extend(b,d?{width:d.width,height:d.height,left:(c.width-d.width)/2,top:(c.height-d.height)/2}:{width:c.width,height:c.height,left:0,top:0});this.$clone.css({width:b.width,height:b.height,marginLeft:b.left,marginTop:b.top,transform:G(b)});a&&this.output()},initCropBox:function(){var a=this.options,c=this.canvas,b=a.aspectRatio,a=q(a.autoCropArea)||.8,d={width:c.width,height:c.height};b&&(c.height*b>c.width?d.height=d.width/b:d.width=d.height*b);this.cropBox=d;this.limitCropBox(!0,!0);d.width=r(l(d.width,d.minWidth),d.maxWidth);d.height=r(l(d.height,d.minHeight),d.maxHeight);d.width=l(d.minWidth,d.width*a);d.height=l(d.minHeight,d.height*a);d.oldLeft=d.left=c.left+(c.width-d.width)/2;d.oldTop=d.top=c.top+(c.height-d.height)/2;this.initialCropBox=k.extend({},d)},limitCropBox:function(a,c){var b=this.options,d=b.aspectRatio,f=this.container,g=f.width,f=f.height,e=this.canvas,n=this.cropBox,h=this.isLimited,m,k;a&&(a=q(b.minCropBoxWidth)||0,b=q(b.minCropBoxHeight)||0,a=r(a,g),b=r(b,f),m=r(g,h?e.width:g),k=r(f,h?e.height:f),d&&(a&&b?b*d>a?b=a/d:a=b*d:a?b=a/d:b&&(a=b*d),k*d>m?k=m/d:m=k*d),n.minWidth=r(a,m),n.minHeight=r(b,k),n.maxWidth=m,n.maxHeight=k);c&&(h?(n.minLeft=l(0,e.left),n.minTop=l(0,e.top),n.maxLeft=r(g,e.left+e.width)-n.width,n.maxTop=r(f,e.top+e.height)-n.height):(n.minLeft=0,n.minTop=0,n.maxLeft=g-n.width,n.maxTop=f-n.height))},renderCropBox:function(){var a=this.options,c=this.container,b=c.width,c=c.height,d=this.cropBox;if(d.width>d.maxWidth||d.width<d.minWidth)d.left=d.oldLeft;if(d.height>d.maxHeight||d.height<d.minHeight)d.top=d.oldTop;d.width=r(l(d.width,d.minWidth),d.maxWidth);d.height=r(l(d.height,d.minHeight),d.maxHeight);this.limitCropBox(!1,!0);d.oldLeft=d.left=r(l(d.left,d.minLeft),d.maxLeft);d.oldTop=d.top=r(l(d.top,d.minTop),d.maxTop);a.movable&&a.cropBoxMovable&&this.$face.data("action",d.width===b&&d.height===c?"move":"all");this.$cropBox.css({width:d.width,height:d.height,left:d.left,top:d.top});this.isCropped&&this.isLimited&&this.limitCanvas(!0,!0);this.isDisabled||this.output()},output:function(){this.preview();this.isCompleted&&this.trigger("crop.cropper",this.getData())},initPreview:function(){var a=K(this.crossOrigin),c=a?this.crossOriginUrl:this.url,b;this.$preview=k(this.options.preview);this.$clone2=b=k("\x3cimg"+a+' src\x3d"'+c+'"\x3e');this.$viewBox.html(b);this.$preview.each(function(){var b=k(this);b.data("preview",{width:b.width(),height:b.height(),html:b.html()});b.html("\x3cimg"+a+' src\x3d"'+c+'" style\x3d"display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;"\x3e')})},resetPreview:function(){this.$preview.each(function(){var a=k(this),c=a.data("preview");a.css({width:c.width,height:c.height}).html(c.html).removeData("preview")})},preview:function(){var a=this.image,c=this.canvas,b=this.cropBox,d=b.width,f=b.height,g=a.width,e=a.height,n=b.left-c.left-a.left,h=b.top-c.top-a.top;this.isCropped&&!this.isDisabled&&(this.$clone2.css({width:g,height:e,marginLeft:-n,marginTop:-h,transform:G(a)}),this.$preview.each(function(){var c=k(this),b=c.data("preview"),t=b.width,b=b.height,r=t,l=b,u=1;d&&(u=t/d,l=f*u);f&&l>b&&(u=b/f,r=d*u,l=b);c.css({width:r,height:l}).find("img").css({width:g*u,height:e*u,marginLeft:-n*u,marginTop:-h*u,transform:G(a)})}))},bind:function(){var a=this.options,c=this.$element,b=this.$cropper;if(k.isFunction(a.cropstart))c.on("cropstart.cropper",a.cropstart);if(k.isFunction(a.cropmove))c.on("cropmove.cropper",a.cropmove);if(k.isFunction(a.cropend))c.on("cropend.cropper",a.cropend);if(k.isFunction(a.crop))c.on("crop.cropper",a.crop);if(k.isFunction(a.zoom))c.on("zoom.cropper",a.zoom);b.on("mousedown touchstart pointerdown MSPointerDown",k.proxy(this.cropStart,this));if(a.zoomable&&a.zoomOnWheel)b.on("wheel mousewheel DOMMouseScroll",k.proxy(this.wheel,this));if(a.toggleDragModeOnDblclick)b.on("dblclick",k.proxy(this.dblclick,this));Q.on("mousemove touchmove pointermove MSPointerMove",this._cropMove=E(this.cropMove,this)).on("mouseup touchend touchcancel pointerup pointercancel MSPointerUp MSPointerCancel",this._cropEnd=E(this.cropEnd,this));if(a.responsive)P.on("resize.cropper",this._resize=E(this.resize,this))},unbind:function(){var a=this.options,c=this.$element,b=this.$cropper;k.isFunction(a.cropstart)&&c.off("cropstart.cropper",a.cropstart);k.isFunction(a.cropmove)&&c.off("cropmove.cropper",a.cropmove);k.isFunction(a.cropend)&&c.off("cropend.cropper",a.cropend);k.isFunction(a.crop)&&c.off("crop.cropper",a.crop);k.isFunction(a.zoom)&&c.off("zoom.cropper",a.zoom);b.off("mousedown touchstart pointerdown MSPointerDown",this.cropStart);a.zoomable&&a.zoomOnWheel&&b.off("wheel mousewheel DOMMouseScroll",this.wheel);a.toggleDragModeOnDblclick&&b.off("dblclick",this.dblclick);Q.off("mousemove touchmove pointermove MSPointerMove",this._cropMove).off("mouseup touchend touchcancel pointerup pointercancel MSPointerUp MSPointerCancel",this._cropEnd);a.responsive&&P.off("resize.cropper",this._resize)},resize:function(){var a=this.options.restore,c=this.$container,b=this.container,d,f,g;!this.isDisabled&&b&&(g=c.width()/b.width,1!==g||c.height()!==b.height)&&(a&&(d=this.getCanvasData(),f=this.getCropBoxData()),this.render(),a&&(this.setCanvasData(k.each(d,function(a,b){d[a]=b*g})),this.setCropBoxData(k.each(f,function(a,b){f[a]=b*g}))))},dblclick:function(){this.isDisabled||(this.$dragBox.hasClass("cropper-crop")?this.setDragMode("move"):this.setDragMode("crop"))},wheel:function(a){var c=a.originalEvent||a,b=q(this.options.wheelZoomRatio)||.1,d=1;this.isDisabled||(a.preventDefault(),this.wheeling||(this.wheeling=!0,setTimeout(k.proxy(function(){this.wheeling=!1},this),50),c.deltaY?d=0<c.deltaY?1:-1:c.wheelDelta?d=-c.wheelDelta/120:c.detail&&(d=0<c.detail?1:-1),this.zoom(-d*b,a)))},cropStart:function(a){var c=this.options,b=a.originalEvent,d=b&&b.touches,f=a,g;if(!this.isDisabled){if(d){f=d.length;if(1<f)if(c.zoomable&&c.zoomOnTouch&&2===f)f=d[1],this.startX2=f.pageX,this.startY2=f.pageY,g="zoom";else return;f=d[0]}g=g||k(f.target).data("action");ea.test(g)&&!this.trigger("cropstart.cropper",{originalEvent:b,action:g}).isDefaultPrevented()&&(a.preventDefault(),this.action=g,this.cropping=!1,this.startX=f.pageX||b&&b.pageX,this.startY=f.pageY||b&&b.pageY,"crop"===g&&(this.cropping=!0,this.$dragBox.addClass("cropper-modal")))}},cropMove:function(a){var c=this.options,b=a.originalEvent,d=b&&b.touches,f=a,g=this.action;if(!this.isDisabled){if(d){f=d.length;if(1<f)if(c.zoomable&&c.zoomOnTouch&&2===f)f=d[1],this.endX2=f.pageX,this.endY2=f.pageY;else return;f=d[0]}g&&!this.trigger("cropmove.cropper",{originalEvent:b,action:g}).isDefaultPrevented()&&(a.preventDefault(),this.endX=f.pageX||b&&b.pageX,this.endY=f.pageY||b&&b.pageY,this.change(f.shiftKey,"zoom"===g?a:null))}},cropEnd:function(a){var c=a.originalEvent,b=this.action;!this.isDisabled&&b&&(a.preventDefault(),this.cropping&&(this.cropping=!1,this.$dragBox.toggleClass("cropper-modal",this.isCropped&&this.options.modal)),this.action="",this.trigger("cropend.cropper",{originalEvent:c,action:b}))},change:function(a,c){var b,d,f,g=this.options.aspectRatio,e=this.action;b=this.container;d=this.canvas;var k=this.cropBox,h=k.width,m=k.height,l=k.left,t=k.top,p=l+h,y=t+m,u=0,q=0,v=b.width,A=b.height,w=!0;!g&&a&&(g=h&&m?h/m:1);this.isLimited&&(u=k.minLeft,q=k.minTop,v=u+r(b.width,d.width,d.left+d.width),A=q+r(b.height,d.height,d.top+d.height));a=this.endX-this.startX;b=this.endY-this.startY;f=d=void 0;g&&(d=b*g,f=a/g);switch(e){case "all":l+=a;t+=b;break;case "e":if(0<=a&&(p>=v||g&&(t<=q||y>=A))){w=!1;break}h+=a;g&&(m=h/g,t-=f/2);0>h&&(e="w",h=0);break;case "n":if(0>=b&&(t<=q||g&&(l<=u||p>=v))){w=!1;break}m-=b;t+=b;g&&(h=m*g,l+=d/2);0>m&&(e="s",m=0);break;case "w":if(0>=a&&(l<=u||g&&(t<=q||y>=A))){w=!1;break}h-=a;l+=a;g&&(m=h/g,t+=f/2);0>h&&(e="e",h=0);break;case "s":if(0<=b&&(y>=A||g&&(l<=u||p>=v))){w=!1;break}m+=b;g&&(h=m*g,l-=d/2);0>m&&(e="n",m=0);break;case "ne":if(g){if(0>=b&&(t<=q||p>=v)){w=!1;break}m-=b;t+=b;h=m*g}else 0<=a?p<v?h+=a:0>=b&&t<=q&&(w=!1):h+=a,0>=b?t>q&&(m-=b,t+=b):(m-=b,t+=b);0>h&&0>m?(e="sw",h=m=0):0>h?(e="nw",h=0):0>m&&(e="se",m=0);break;case "nw":if(g){if(0>=b&&(t<=q||l<=u)){w=!1;break}m-=b;t+=b;h=m*g;l+=d}else 0>=a?l>u?(h-=a,l+=a):0>=b&&t<=q&&(w=!1):(h-=a,l+=a),0>=b?t>q&&(m-=b,t+=b):(m-=b,t+=b);0>h&&0>m?(e="se",h=m=0):0>h?(e="ne",h=0):0>m&&(e="sw",m=0);break;case "sw":if(g){if(0>=a&&(l<=u||y>=A)){w=!1;break}h-=a;l+=a;m=h/g}else 0>=a?l>u?(h-=a,l+=a):0<=b&&y>=A&&(w=!1):(h-=a,l+=a),0<=b?y<A&&(m+=b):m+=b;0>h&&0>m?(e="ne",h=m=0):0>h?(e="se",h=0):0>m&&(e="nw",m=0);break;case "se":if(g){if(0<=a&&(p>=v||y>=A)){w=!1;break}h+=a;m=h/g}else 0<=a?p<v?h+=a:0<=b&&y>=A&&(w=!1):h+=a,0<=b?y<A&&(m+=b):m+=b;0>h&&0>m?(e="nw",h=m=0):0>h?(e="sw",h=0):0>m&&(e="ne",m=0);break;case "move":this.move(a,b);w=!1;break;case "zoom":this.zoom(function(a,b,c,d){a=T(a*a+b*b);return(T(c*c+d*d)-a)/a}(z(this.startX-this.startX2),z(this.startY-this.startY2),z(this.endX-this.endX2),z(this.endY-this.endY2)),c);this.startX2=this.endX2;this.startY2=this.endY2;w=!1;break;case "crop":a&&b?(c=this.$cropper.offset(),l=this.startX-c.left,t=this.startY-c.top,h=k.minWidth,m=k.minHeight,0<a?e=0<b?"se":"ne":0>a&&(l-=h,e=0<b?"sw":"nw"),0>b&&(t-=m),this.isCropped||(this.$cropBox.removeClass("cropper-hidden"),this.isCropped=!0,this.isLimited&&this.limitCropBox(!0,!0))):w=!1}w&&(k.width=h,k.height=m,k.left=l,k.top=t,this.action=e,this.renderCropBox());this.startX=this.endX;this.startY=this.endY},crop:function(){this.isBuilt&&!this.isDisabled&&(this.isCropped||(this.isCropped=!0,this.limitCropBox(!0,!0),this.options.modal&&this.$dragBox.addClass("cropper-modal"),this.$cropBox.removeClass("cropper-hidden")),this.setCropBoxData(this.initialCropBox))},reset:function(){this.isBuilt&&!this.isDisabled&&(this.image=k.extend({},this.initialImage),this.canvas=k.extend({},this.initialCanvas),this.cropBox=k.extend({},this.initialCropBox),this.renderCanvas(),this.isCropped&&this.renderCropBox())},clear:function(){this.isCropped&&!this.isDisabled&&(k.extend(this.cropBox,{left:0,top:0,width:0,height:0}),this.isCropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),this.$dragBox.removeClass("cropper-modal"),this.$cropBox.addClass("cropper-hidden"))},replace:function(a,c){!this.isDisabled&&a&&(this.isImg&&this.$element.attr("src",a),c?(this.url=a,this.$clone.attr("src",a),this.isBuilt&&this.$preview.find("img").add(this.$clone2).attr("src",a)):(this.isImg&&(this.isReplaced=!0),this.options.data=null,this.load(a)))},enable:function(){this.isBuilt&&(this.isDisabled=!1,this.$cropper.removeClass("cropper-disabled"))},disable:function(){this.isBuilt&&(this.isDisabled=!0,this.$cropper.addClass("cropper-disabled"))},destroy:function(){var a=this.$element;this.isLoaded?(this.isImg&&this.isReplaced&&a.attr("src",this.originalUrl),this.unbuild(),a.removeClass("cropper-hidden")):this.isImg?a.off("load.cropper",this.start):this.$clone&&this.$clone.remove();a.removeData("cropper")},move:function(a,c){var b=this.canvas;this.moveTo(B(a)?a:b.left+q(a),B(c)?c:b.top+q(c))},moveTo:function(a,c){var b=this.canvas,d=!1;B(c)&&(c=a);a=q(a);c=q(c);this.isBuilt&&!this.isDisabled&&this.options.movable&&(p(a)&&(b.left=a,d=!0),p(c)&&(b.top=c,d=!0),d&&this.renderCanvas(!0))},zoom:function(a,c){var b=this.canvas;a=q(a);this.zoomTo(b.width*(0>a?1/(1-a):1+a)/b.naturalWidth,c)},zoomTo:function(a,c){var b=this.options,d=this.canvas,f=d.width,g=d.height,e=d.naturalWidth,k=d.naturalHeight,h;a=q(a);0<=a&&this.isBuilt&&!this.isDisabled&&b.zoomable&&(b=e*a,a*=k,c&&(h=c.originalEvent),this.trigger("zoom.cropper",{originalEvent:h,oldRatio:f/e,ratio:b/e}).isDefaultPrevented()||(h?(e=this.$cropper.offset(),c=h.touches?Z(h.touches):{pageX:c.pageX||h.pageX||0,pageY:c.pageY||h.pageY||0},d.left-=(c.pageX-e.left-d.left)/f*(b-f),d.top-=(c.pageY-e.top-d.top)/g*(a-g)):(d.left-=(b-f)/2,d.top-=(a-g)/2),d.width=b,d.height=a,this.renderCanvas(!0)))},rotate:function(a){this.rotateTo((this.image.rotate||0)+q(a))},rotateTo:function(a){a=q(a);p(a)&&this.isBuilt&&!this.isDisabled&&this.options.rotatable&&(this.image.rotate=a%360,this.isRotated=!0,this.renderCanvas(!0))},scale:function(a,c){var b=this.image,d=!1;B(c)&&(c=a);a=q(a);c=q(c);this.isBuilt&&!this.isDisabled&&this.options.scalable&&(p(a)&&(b.scaleX=a,d=!0),p(c)&&(b.scaleY=c,d=!0),d&&this.renderImage(!0))},scaleX:function(a){var c=this.image.scaleY;this.scale(a,p(c)?c:1)},scaleY:function(a){var c=this.image.scaleX;this.scale(p(c)?c:1,a)},getData:function(a){var c=this.options,b=this.image,d=this.canvas,f=this.cropBox,g,e;this.isBuilt&&this.isCropped?(e={x:f.left-d.left,y:f.top-d.top,width:f.width,height:f.height},g=b.width/b.naturalWidth,k.each(e,function(b,c){c/=g;e[b]=a?U(c):c})):e={x:0,y:0,width:0,height:0};c.rotatable&&(e.rotate=b.rotate||0);c.scalable&&(e.scaleX=b.scaleX||1,e.scaleY=b.scaleY||1);return e},setData:function(a){var c=this.options,b=this.image,d=this.canvas,f={},g,e;k.isFunction(a)&&(a=a.call(this.element));this.isBuilt&&!this.isDisabled&&k.isPlainObject(a)&&(c.rotatable&&p(a.rotate)&&a.rotate!==b.rotate&&(b.rotate=a.rotate,this.isRotated=g=!0),c.scalable&&(p(a.scaleX)&&a.scaleX!==b.scaleX&&(b.scaleX=a.scaleX,e=!0),p(a.scaleY)&&a.scaleY!==b.scaleY&&(b.scaleY=a.scaleY,e=!0)),g?this.renderCanvas():e&&this.renderImage(),c=b.width/b.naturalWidth,p(a.x)&&(f.left=a.x*c+d.left),p(a.y)&&(f.top=a.y*c+d.top),p(a.width)&&(f.width=a.width*c),p(a.height)&&(f.height=a.height*c),this.setCropBoxData(f))},getContainerData:function(){return this.isBuilt?this.container:{}},getImageData:function(){return this.isLoaded?this.image:{}},getCanvasData:function(){var a=this.canvas,c={};this.isBuilt&&k.each("left top width height naturalWidth naturalHeight".split(" "),function(b,d){c[d]=a[d]});return c},setCanvasData:function(a){var c=this.canvas,b=c.aspectRatio;k.isFunction(a)&&(a=a.call(this.$element));this.isBuilt&&!this.isDisabled&&k.isPlainObject(a)&&(p(a.left)&&(c.left=a.left),p(a.top)&&(c.top=a.top),p(a.width)?(c.width=a.width,c.height=a.width/b):p(a.height)&&(c.height=a.height,c.width=a.height*b),this.renderCanvas(!0))},getCropBoxData:function(){var a=this.cropBox,c;this.isBuilt&&this.isCropped&&(c={left:a.left,top:a.top,width:a.width,height:a.height});return c||{}},setCropBoxData:function(a){var c=this.cropBox,b=this.options.aspectRatio,d,f;k.isFunction(a)&&(a=a.call(this.$element));this.isBuilt&&this.isCropped&&!this.isDisabled&&k.isPlainObject(a)&&(p(a.left)&&(c.left=a.left),p(a.top)&&(c.top=a.top),p(a.width)&&(d=!0,c.width=a.width),p(a.height)&&(f=!0,c.height=a.height),b&&(d?c.height=c.width/b:f&&(c.width=c.height*b)),this.renderCropBox())},getCroppedCanvas:function(a){var c,b,d,f,g,e,l,h;if(this.isBuilt&&S){if(!this.isCropped)return M(this.$clone[0],this.image);k.isPlainObject(a)||(a={});h=this.getData();c=h.width;b=h.height;e=c/b;k.isPlainObject(a)&&(d=a.width,f=a.height,d?(f=d/e,g=d/c):f&&(d=f*e,g=f/b));d=v(d||c);f=v(f||b);e=k("\x3ccanvas\x3e")[0];e.width=d;e.height=f;l=e.getContext("2d");a.fillColor&&(l.fillStyle=a.fillColor,l.fillRect(0,0,d,f));l.drawImage.apply(l,function(){var a=M(this.$clone[0],this.image),d=a.width,f=a.height,e=this.canvas,a=[a],k=h.x+e.naturalWidth*(z(h.scaleX||1)-1)/2,e=h.y+e.naturalHeight*(z(h.scaleY||1)-1)/2,l,n,p,q,w,x;k<=-c||k>d?k=l=p=w=0:0>=k?(p=-k,k=0,l=w=r(d,c+k)):k<=d&&(p=0,l=w=r(c,d-k));0>=l||e<=-b||e>f?e=n=q=x=0:0>=e?(q=-e,e=0,n=x=r(f,b+e)):e<=f&&(q=0,n=x=r(b,f-e));a.push(v(k),v(e),v(l),v(n));g&&(p*=g,q*=g,w*=g,x*=g);0<w&&0<x&&a.push(v(p),v(q),v(w),v(x));return a}.call(this));return e}},setAspectRatio:function(a){var c=this.options;this.isDisabled||B(a)||(c.aspectRatio=l(0,a)||NaN,this.isBuilt&&(this.initCropBox(),this.isCropped&&this.renderCropBox()))},setDragMode:function(a){var c=this.options,b,d;this.isLoaded&&!this.isDisabled&&(b="crop"===a,d=c.movable&&"move"===a,a=b||d?a:"none",this.$dragBox.data("action",a).toggleClass("cropper-crop",b).toggleClass("cropper-move",d),c.cropBoxMovable||this.$face.data("action",a).toggleClass("cropper-crop",b).toggleClass("cropper-move",d))}};x.DEFAULTS={viewMode:0,dragMode:"crop",aspectRatio:NaN,data:null,preview:"",responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:200,minContainerHeight:100,build:null,built:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null};x.setDefaults=function(a){k.extend(x.DEFAULTS,a)};x.TEMPLATE='\x3cdiv class\x3d"cropper-container"\x3e\x3cdiv class\x3d"cropper-wrap-box"\x3e\x3cdiv class\x3d"cropper-canvas"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"cropper-drag-box"\x3e\x3c/div\x3e\x3cdiv class\x3d"cropper-crop-box"\x3e\x3cspan class\x3d"cropper-view-box"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-dashed dashed-h"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-dashed dashed-v"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-center"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-face"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-line line-e" data-action\x3d"e"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-line line-n" data-action\x3d"n"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-line line-w" data-action\x3d"w"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-line line-s" data-action\x3d"s"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-point point-e" data-action\x3d"e"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-point point-n" data-action\x3d"n"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-point point-w" data-action\x3d"w"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-point point-s" data-action\x3d"s"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-point point-ne" data-action\x3d"ne"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-point point-nw" data-action\x3d"nw"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-point point-sw" data-action\x3d"sw"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-point point-se" data-action\x3d"se"\x3e\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e';x.other=k.fn.cropper;k.fn.cropper=function(a){var c=D(arguments,1),b;this.each(function(){var d=k(this),f=d.data("cropper"),g;if(!f){if(/destroy/.test(a))return;f=k.extend({},d.data(),k.isPlainObject(a)&&a);d.data("cropper",f=new x(this,f))}"string"===typeof a&&k.isFunction(g=f[a])&&(b=g.apply(f,c))});return B(b)?this:b};k.fn.cropper.Constructor=x;k.fn.cropper.setDefaults=x.setDefaults;k.fn.cropper.noConflict=function(){k.fn.cropper=x.other;return this}});