'use strict';var TRANSVERSE=14,VERTICAL=14,LEFT=1,RIGHT=2,TOP=3,BOTTOM=4,LEFT_TOP=5,LEFT_BOTTOM=6,RIGHT_TOP=7,RIGHT_BOTTOM=8,Chess=function(){var c="",a=!1;this.getOwner=function(){return c};this.setOwner=function(b){c=b};this.getVictory=function(){return a};this.setVictory=function(b){a=b}},Board=function(){var c=[],a=!1;this.getChess=function(b){return c[b.y][b.x]};this.setChess=function(b,a){c[a.y][a.x]=b};this.setVictory=function(b){for(var c=0;c<b.length;c++)for(var a=0;a<b[c].length;a++)this.getChess(b[c][a]).setVictory(!0)};this.getAvaiablePoints=function(){for(var b=[],a=0;a<=VERTICAL;a++)for(var e=0;e<=TRANSVERSE;e++)c[a][e]||b.push({x:e,y:a});return b};this.getMap=function(){for(var b={},a=0;a<=VERTICAL;a++)for(var e=0;e<=TRANSVERSE;e++){var f=c[a][e],g;f?(g=f.getOwner(),f.getVictory()&&(g+="_star")):g="";b[e+","+a]=g}return b};this.gameOver=function(){return a=!0};this.isGameOver=function(){return a};this.getNextPoint=function(b,a){b={x:b.x,y:b.y};switch(a){case LEFT:--b.x;break;case RIGHT:b.x+=1;break;case TOP:--b.y;break;case BOTTOM:b.y+=1;break;case LEFT_TOP:--b.x;--b.y;break;case RIGHT_TOP:b.x+=1;--b.y;break;case LEFT_BOTTOM:--b.x;b.y+=1;break;case RIGHT_BOTTOM:b.x+=1;b.y+=1;break;default:alert("\u65b9\u5411\u9519\u8bef")}return b};(function(){for(var a=0;a<=VERTICAL;a++)c.push([])})()},Compute=function(c){var a=[LEFT,TOP,RIGHT,BOTTOM,LEFT_TOP,LEFT_BOTTOM,RIGHT_TOP,RIGHT_BOTTOM],b=0;this._computeScore=function(a){throw Error("\u672a\u5b9e\u73b0");};this._convertToPattern=function(a){return c.convertToPattern(a)};this.compute=function(c){for(var e=b=0,f;f=a[e++];)b+=this._computeScore(c,f)};this.getScore=function(a){return b}},Five=function(c){Compute.call(this,c);this._computeScore=function(a,b){var d;d=c.find(a,b,4);d="IIII"==c.convertToPattern(d)?!0:!1;if(!d){var e=c.find(a,b,2);d=c.find(a,c.reverseDirection(b),2);e=c.convertToPattern(e);d=c.convertToPattern(d);d="II"==e&&"II"==d?!0:!1}d||(d=c.find(a,b,3),a=c.find(a,c.reverseDirection(b),1),b=c.convertToPattern(d),a=c.convertToPattern(a),d="III"==b&&"I"==a?!0:!1);return d?1E5:0}},Four_Live=function(c){Compute.call(this,c);this._computeScore=function(a,b){var d=0,e=c.find(a,b,4);a=c.find(a,c.reverseDirection(b),1);e=this._convertToPattern(e);a=this._convertToPattern(a);"III0"==e&&"0"==a&&(d=1E4);return d}},Four_Live1=function(c){Compute.call(this,c);this._computeScore=function(a,b){var d=c.find(a,b,3);a=c.find(a,c.reverseDirection(b),2);d=this._convertToPattern(d);a=this._convertToPattern(a);return"II0"==d&&"I0"==a?1E4:0}},Tree_Live=function(c){Compute.call(this,c);this._computeScore=function(a,b){var d=0,e=c.find(a,b,3);a=c.find(a,c.reverseDirection(b),2);e=this._convertToPattern(e);a=this._convertToPattern(a);"II0"==e&&"00"==a&&(d+=1E3);return d}},Tree_Live1=function(c){Compute.call(this,c);this._computeScore=function(a,b){var d=c.find(a,b,2);a=c.find(a,c.reverseDirection(b),3);d=this._convertToPattern(d);a=this._convertToPattern(a);return"I0"==d&&"I00"==a?1E3:0}},Two_Live=function(c){Compute.call(this,c);this._computeScore=function(a,b){var d=c.find(a,b,3);a=c.find(a,c.reverseDirection(b),2);d=this._convertToPattern(d);a=this._convertToPattern(a);return"I00"==d&&"00"==a?100:0}},One_Live=function(c){Compute.call(this,c);this._computeScore=function(a,b){var d=c.find(a,b,3);a=c.find(a,c.reverseDirection(b),3);d=this._convertToPattern(d);a=this._convertToPattern(a);return"000"==d&&"000"==a?10:0}},Four_End=function(c){Compute.call(this,c);this._computeScore=function(a,b){var d=c.find(a,b,3);a=c.find(a,c.reverseDirection(b),1);d=this._convertToPattern(d);a=this._convertToPattern(a);return"III"==d&&"0"==a?150:0}},Role=function(c){var a=[],b=this,d=!1;this.isVictory=function(){return d};var e=function(b){for(var c=0,d=0,e;e=a[d++];)e.compute(b),c+=e.getScore();return{score:c,point:b}},f=function(){for(var a=[],b=c.getAvaiablePoints(),d=0,h;h=b[d++];)a.push(e(h));return a};this.getCode=function(){throw Error("\u672a\u5b9e\u73b0");};this.getPeak=function(){var a=f();a.sort(function(a,b){return b.score-a.score});return a[0]};this.convertToPattern=function(a){var b="";if(!a)return"";for(var c=0;c<a.length;c++)var d=a[c],b=void 0==d?b+"0":d.getOwner()==this.getCode()?b+"I":b+"Y";return b};this.reverseDirection=function(a){switch(a){case LEFT:return RIGHT;case RIGHT:return LEFT;case TOP:return BOTTOM;case BOTTOM:return TOP;case LEFT_TOP:return RIGHT_BOTTOM;case RIGHT_BOTTOM:return LEFT_TOP;case RIGHT_TOP:return LEFT_BOTTOM;case LEFT_BOTTOM:return RIGHT_TOP;default:alert("\u65b9\u5411\u9519\u8bef")}};this._checkGameOver=function(a){var b=k(a,LEFT),e=k(a,TOP),h=k(a,LEFT_TOP);a=k(a,RIGHT_TOP);b=[b,e,h,a];e=[];for(h=0;h<b.length;h++)5<=b[h].length&&e.push(b[h]);0<e.length&&(c.gameOver(),c.setVictory(e),d=!0);0==c.getAvaiablePoints().length&&c.gameOver()};var g=function(a){return 0<=a.x&&0<=a.y&&a.x<=TRANSVERSE&&a.y<=VERTICAL&&c.getChess(a)&&c.getChess(a).getOwner()==b.getCode()},k=function(a,d){for(var e=b.reverseDirection(d),h=[],f={x:a.x,y:a.y};;){a=c.getNextPoint(f,d);if(!g(a))break;f={x:a.x,y:a.y}}for(;;){h.push(f);a=c.getNextPoint(f,e);if(!g(a))break;f={x:a.x,y:a.y}}return h};this.find=function(a,b,d){var e={x:a.x,y:a.y};a=[];for(var f=1;f<=d;){e=c.getNextPoint(e,b);if(0>e.x||0>e.y||e.x>TRANSVERSE||e.y>VERTICAL)return null;var g=c.getChess(e);g&&(g.point={x:e.x,y:e.y});a.push(g);f++}return a};a.push(new Five(b));a.push(new Four_Live(b));a.push(new Tree_Live(b));a.push(new Four_Live1(b));a.push(new Tree_Live1(b));a.push(new Two_Live(b));a.push(new One_Live(b));a.push(new Four_End(b))},Machine=function(c,a){Role.call(this,c);this.setChess=function(){if(!c.isGameOver()){var b=this.getPeak(),d=a.getPeak(),b=b.score>=d.score?b:d,d=new Chess;d.setOwner(this.getCode());c.setChess(d,b.point);this._checkGameOver(b.point)}};this.getCode=function(){return"machine"}},Person=function(c,a){Role.call(this,c);this.setChess=function(a,d){if(!c.isGameOver()){var e={};e.x=a;e.y=d;a=new Chess;a.setOwner(this.getCode());c.setChess(a,e);this._checkGameOver(e)}};this.getCode=function(){return"person"}},UIBase=function(){var c=this;this._id="$UI"+ ++UIBase.index;this._globalKey="";this.getHTML=function(){return""};this.renderHTML=function(){var a=this.getHTML(),a=a.replace(/\$\$/g,c._globalKey);return a=a.replace(/&&/g,c._id)};this.getDOM=function(){return document.getElementById(this._id)};c._globalKey="window.$UI_Items."+c._id;window.$UI_Items=window.$UI_Items||{};window.$UI_Items[c._id]=c};UIBase.index=0;var ChessUI=function(c,a){UIBase.call(this);this.setChess=function(){};this.getHTML=function(){var a="",d=c.getMap(),e;for(e in d){var f="",g=d[e];""==g&&(f="$$._setChess("+e+")");a+='\x3cdiv onclick\x3d"'+f+'" class\x3d"'+g+'"\x3e\x3c/div\x3e'}return a};this.draw=function(){var b=this.renderHTML();document.getElementById(a).innerHTML=b};this._setChess=function(a,c){this.setChess(a,c)};this.draw()};function getMSIEVersion(){var c=/MSIE([^;]+)/.exec(navigator.userAgent);if(c)return parseInt(c[1])}function initGame(){$(".board").css({backgroundImage:"none",background:"#fff"});$(".ipt").css({display:"none"});if(1==$(".ipt").attr("abc"))prompt1("500","2000",!1,"\u5f88\u9057\u61be\uff0c\u6ca1\u6709\u83b7\u5f97\u91d1\u5e01");else if(0==$(".ipt").attr("abc")){prompt1("500","2000",!0,"\u606d\u559c\u4f60\u83b7\u5f9750\u91d1\u5e01");var c=localStorage.getItem("gold_key");localStorage.setItem("gold_key",Number(c)+50)}if((c=getMSIEVersion())&&8>=c)alert("\u8bf7\u4f7f\u7528\u975eIE\u6d4f\u89c8\u5668(ie9\u300110\u9664\u5916)\u8fdb\u884c\u6e38\u620f(google chrome \u3001firefox\u7b49 )");else{var a=new Board,b=new Person(a),d=new Machine(a,b),e=new ChessUI(a,"board");e.setChess=function(c,g){b.setChess(c,g);d.setChess();e.draw();a.isGameOver()&&(b.isVictory()?(prompt("500","2000",!0,"\u60a8\u83b7\u5f97\u4e86\u80dc\u5229"),$(".ipt").css({display:"block"}).attr("abc","0")):d.isVictory()?(prompt("500","2000",!1,"\u673a\u5668\u83b7\u5f97\u4e86\u80dc\u5229"),$(".ipt").css({display:"block"}).attr("abc","1")):(prompt("500","2000",!1,"\u6e38\u620f\u7ed3\u675f\uff0c\u80dc\u8d1f\u672a\u5206"),$(".ipt").css({display:"block"})))};Math.floor(10*Math.random())%2?(prompt("500","2000",!1,"\u673a\u5668\u6267\u68cb"),d.setChess(),e.draw()):prompt("500","2000",!0,"\u60a8\u6267\u68cb")}};